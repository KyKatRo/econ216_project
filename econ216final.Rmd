---
title: "Econ 216 Final Project"
author: "Kyler Rosen, Raunak Bhumsaria, Gordon Bradley, and Alex Illchev"
date: "`r Sys.Date()`"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


## Load and Inspect Data

```{r}
# Load necessary libraries
library(tidyverse)
library(lubridate)
library(ggmap)

us_map <- map_data("state")


# Load the data
data <- read.csv("uswtdb_v4_3_20220114.csv")

# Inspect the first few rows of the data
head(data)

# Summarize the data to understand its structure
summary(data)
```

## Histograms and Bar Plots

Discuss the distribution of each variable using histograms for continuous variables and bar plots for categorical variables.

```{r}
# Histogram for 'p_cap'
ggplot(data, aes(x = p_cap)) +
  geom_histogram(bins = 30, fill = "blue", color = "black") +
  labs(x = "Capacity (MW)", y = "Frequency", title = "Histogram of Capacity")

# Histogram for 't_hh'
ggplot(data, aes(x = t_hh)) +
  geom_histogram(bins = 30, fill = "green", color = "black") +
  labs(x = "Turbine Hub Height (m)", y = "Frequency", title = "Histogram of Turbine Hub Height")

# Bar plot for 't_state'
ggplot(data, aes(x = t_state)) +
  geom_bar(stat = "count", fill = "coral") +
  labs(x = "State", y = "Count", title = "Bar Plot of States") + 
theme(axis.text.x = element_text(angle = 60, hjust = 1))



# Scatter plot for geographic coordinates 'xlong' and 'ylat'
ggplot(data, aes(x = xlong, y = ylat)) +
  geom_point(aes(color = t_state)) +
  labs(x = "Longitude", y = "Latitude", title = "Geographic Distribution of Turbines")


```

## Exploring Relationships

Analyze relationships between variables using scatter plots, box plots, etc.


# Scatter plot for two continuous variables
ggplot(data, aes(x = continuous_variable_1, y = continuous_variable_2)) + 
  geom_point() + 
  labs(title = "Scatter Plot of Variable 1 vs Variable 2", x = "Variable 1", y = "Variable 2")

# Box plot for a continuous and a categorical variable
ggplot(data, aes(x = factor_variable_1, y = continuous_variable_1)) + 
  geom_boxplot() + 
  labs(title = "Box Plot of Continuous Variable 1 by Factor Variable 1", x = "Factor Variable 1", y = "Continuous Variable 1")

## Documentation of Findings

Include comments and observations about each visualization to discuss the features of the data that are important for understanding your analysis. Highlight any issues or anomalies found during the exploratory phase and describe how they might impact your further analysis or decision-making process.

Throughout this process, make sure to label all visualizations clearly with plain English descriptions of the variables on the axes or facet labels to ensure they are understandable and accessible.
```

```{r}
# Histograms for continuous variables (e.g., p_cap, t_cap, t_hh, t_rd, t_rsa, t_ttlh)
continuous_vars <- c("p_cap", "t_cap", "t_hh", "t_rd", "t_rsa", "t_ttlh")

for (var in continuous_vars) {
  print(ggplot(data, aes_string(x = var)) +
          geom_histogram(binwidth = 1, fill = "blue", color = "black") +
          labs(x = var, y = "Frequency", title = paste("Distribution of", var)) +
          theme_minimal())
}

# Bar plots for categorical variables (e.g., t_state, t_county, t_manu, t_model, retrofit, t_conf_atr, t_conf_loc)
categorical_vars <- c("t_state", "t_manu", "t_model", "retrofit", "t_conf_atr", "t_conf_loc")

for (var in categorical_vars) {
  print(ggplot(data, aes_string(x = var)) +
          geom_bar(fill = "coral", color = "black") +
          labs(x = var, y = "Count", title = paste("Count of", var)) +
          theme_minimal() +
          theme(axis.text.x = element_text(angle = 90, hjust = 1)))
}

# Bar plot for year variables (e.g., p_year, retrofit_year)
year_vars <- c("p_year", "retrofit_year")

for (var in year_vars) {
  data[[var]] <- as.factor(data[[var]])
  
  print(ggplot(data, aes_string(x = var)) +
          geom_bar(fill = "green", color = "black") +
          labs(x = var, y = "Count", title = paste("Count of", var)) +
          theme_minimal() +
          theme(axis.text.x = element_text(angle = 90, hjust = 1)))
}

# Convert date to Date format
data$t_img_date <- as.Date(data$t_img_date, format = "%m/%d/%Y")

# Line chart for date variable 't_img_date'
ggplot(data, aes(x = t_img_date)) +
  geom_line(stat = "count", aes(group = 1)) +
  labs(x = "Date", y = "Count", title = "Number of Images Over Time")

base_map <- get_stamenmap(bbox = c(left = min(data$xlong), bottom = min(data$ylat), 
                                   right = max(data$xlong), top = max(data$ylat)), 
                          zoom = 6, maptype = "terrain-background")

# Now plot the map with points
ggmap(base_map) +
  geom_point(data = data, aes(x = xlong, y = ylat, color = t_state), size = 1) +
  labs(x = "Longitude", y = "Latitude", title = "Geographic Distribution of Turbines") +
  theme_minimal()

# Correlation plot if there are multiple numeric variables
numeric_data <- data %>% select_if(is.numeric)
correlation_matrix <- cor(numeric_data, use = "complete.obs")
print(ggplot(data = as.data.frame(as.table(correlation_matrix)),
       aes(x = Var1, y = Var2, fill = Freq)) +
  geom_tile() +
  scale_fill_gradient2(low = "blue", high = "red", mid = "white", midpoint = 0, limit = c(-1,1)) +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)))

# Add comments for each visualization in R Markdown

# End of EDA section with session information
sessionInfo()
```
