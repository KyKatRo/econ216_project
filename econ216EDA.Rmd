---
title: "Econ 216 Exploratory Data Analysis"
author: "Kyler Rosen, Raunak Bhumsaria, Gordon Bradley, and Alex Illchev"
date: "`r Sys.Date()`"
output: pdf_document
---
## Introduction


In this project we aim to examine the geographic distribution and capacity characteristics of wind turbines in the United States using the US Wind Turbine Database (USWTDB). We plan to do this by analyzing the placement and various attributes of wind turbines in the US in hopes of finding insights into the wind energy landscape over all 50 states.


Using the data from the dataset we believe we can investigate the impact of local vs federal policies on wind energy development through two methods. The first is by the geographic mapping of wind turbines in the US; this can visually display where these turbines are located on a map which in turn can show us various clusters of the turbines distributions. This visualization can be used to identify areas of high wind energy concentration and relate these areas to geographic and policy factors of certain local or state governments.The second way is visualizing the number of wind turbines per each US state. This data can be compared with certain state policies or with federal wind energy incentives in each region. This can be all combined to show us which states are leading in wind energy production and possibly find patterns of wind energy adoption nationally.


Using the data set we can also investigate the capacity distribution and also win turbine hub height of all the wind turbines in the US. This data would let us discover insights on the range, efficiency, and sizes of the turbines in terms of their power output and hub height. This could possibly allow us to look at technological trends nationally for wind turbine and even see how many advanced wind projects have been made.

## Background
The dataset we are using is the United States Wind Turbine Database (USWTDB). We retrieved this from: https://eerscmap.usgs.gov/uswtdb/. What follows is the details about the dataset:

### Dataset Structure:

- **Observation Level:** Each observation represents a single wind turbine within the United States.
- **Variables Included:** Here are the key variables contained in the dataset:

1. **case_id:** Unique stable identification number for each turbine.
2. **faa_ors, faa_asn:** Unique identifiers for cross-reference to FAA digital obstacle files and FAA obstruction evaluation airport airspace analysis dataset.
3. **usgs_pr_id:** Unique identifier for cross-reference to the 2014 USGS turbine dataset.
4. **t_state:** State where the turbine is located.
5. **t_county, t_fips:** County and state FIPS code where the turbine is located.
6. **p_name:** Name of the wind power project the turbine is a part of.
7. **p_year:** Year that the turbine became operational.
8. **p_tnum:** Number of turbines in the wind power project.
9. **p_cap:** Cumulative capacity of all turbines in the project (in MW).
10. **t_manu, t_model:** Turbine manufacturer and model.
11. **t_cap:** Turbine rated capacity (in kW).
12. **t_hh:** Turbine hub height (in meters).
13. **t_rd:** Turbine rotor diameter (in meters).
14. **t_rsa:** Turbine rotor swept area (in square meters).
15. **t_ttlh:** Turbine total height from ground to tip of a blade (in meters).
16. **retrofit, retrofit_year:** Indicator and year of partial retrofit, if applicable.
17. **t_conf_atr, t_conf_loc:** Confidence levels in turbine attributes and location.
18. **t_img_date, t_img_srce:** Date and source of image used to visually verify turbine location.
19. **xlong, ylat:** Longitude and latitude of the turbine point.
20. **eia_id:** Plant ID from the Energy Information Administration (EIA).

### Important Variables for Analysis:

1. **t_state:** Allows for analysis based on geographical location and comparison between states.
2. **p_year:** Provides insight into the temporal distribution of wind turbine constructions.
3. **p_tnum:** Helps in understanding the scale of wind power projects.
4. **p_cap:** Indicates the total power capacity of wind projects, crucial for assessing energy generation potential.
5. **t_hh, t_rd, t_rsa, t_ttlh:** These dimensions are essential for understanding turbine design and efficiency.
  

The phenomenon under study is the geographic distribution and various attributes of wind turbines in the United States. The dataset being used for this Exploratory Data Analysis (EDA) is the United States Wind Turbine Database (USWTDB), which tracks the current locations and pertinent information of both land-based and offshore wind turbines across the country. This dataset includes a wealth of data points on over 70,000 wind turbines.

To effectively analyze and interpret the data, one must consider the interplay between the column attributes and external factors such as economic incentives, technological advancements, environmental considerations, and policy changes. The goal of the EDA would be to use visualizations like maps, scatter plots, histograms, and time series charts to uncover patterns, correlations, and trends that could inform stakeholders and guide policy and investment decisions in the wind energy sector.


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


## Data Wrangling

```{r}
# Load necessary libraries
library(tidyverse)
library(lubridate)
library(ggmap)
library(dplyr)

us_map <- map_data("state")


# Load the data
data <- read.csv("uswtdb_v4_3_20220114.csv")

# Inspect the first few rows of the data
head(data)

# Summarize the data to understand its structure
summary(data)
```


```{r}
# Convert date to Date format
## We want it in the Date format since it allows us to do easier modifications to the variables
data$t_img_date <- as.Date(data$t_img_date, format = "%m/%d/%Y")


## Data pre-2015 seems very unreliable pre-2015 so I am cutting off before then.
data_after_2015 <- data %>%
  filter(t_img_date > as.Date("2014-12-31"))


# Aggregate data by month
## Data is very noisy so collecting by month makes the data bit easier to parse.
monthly_data <- data_after_2015 %>%
  group_by(month = floor_date(t_img_date, "month")) %>%
  summarise(count = n())

## Need to establish bounding boxes on geographic areas for the maps
continental_bbox <- c(left = -125, bottom = 24, right = -66, top = 49)
alaska_bbox <- c(left = -170, bottom = 52, right = -130, top = 72)
hawaii_bbox <- c(left = -160, bottom = 18, right = -154, top = 23)

## Grabbing all numeric data for a rough analysis
numeric_data <- data %>% select_if(is.numeric)

```

## Exploratory Analysis

```{r}
# Histograms for continuous variables
continuous_vars <- c("p_cap", "t_cap", "t_hh", "t_rd", "t_rsa", "t_ttlh")
continuous_titles <- c("Project Power Capacity (MW)", "Turbine Rated Capacity (kW)", 
                       "Turbine Hub Height (m)", "Turbine Rotor Diameter (m)", 
                       "Turbine Rotor Sweep Area (sq m)", "Total Turbine Height (m)")

binwidths <- c(10, 100, 5, 2.5, 500, 5)


for (i in 1:length(continuous_vars)) {
  var <- continuous_vars[i]
  title <- continuous_titles[i]
  binwidth <- binwidths[i]
  
  print(ggplot(data, aes_string(x = var)) +
          geom_histogram(binwidth = binwidth, fill = "blue", color = "black") +
          labs(x = title, y = "Frequency", title = paste("Distribution of", title)) +
          theme_minimal())
}

```

```{r}
# Bar plots for categorical variables
categorical_vars <- c("t_state", "retrofit", "t_conf_atr", "t_conf_loc")
categorical_titles <- c("State", "Retrofit Status", "Configuration Attribute", "Configuration Location")

for (i in 1:length(categorical_vars)) {
  var <- categorical_vars[i]
  title <- categorical_titles[i]
  
  print(ggplot(data, aes_string(x = var)) +
          geom_bar(fill = "coral", color = "black") +
          labs(x = title, y = "Count", title = paste("Turbine Count by", title)) +
          theme_minimal() +
          theme(axis.text.x = element_text(angle = 90, hjust = 1)))
}

```

```{r}
# Bar plot for year variables
year_vars <- c("p_year", "retrofit_year")
year_titles <- c("Production Year", "Retrofit Year")

for (i in 1:length(year_vars)) {
  var <- year_vars[i]
  title <- year_titles[i]
  
  data[[var]] <- as.factor(data[[var]])
  
  print(ggplot(data, aes_string(x = var)) +
          geom_bar(fill = "green", color = "black") +
          labs(x = title, y = "Count", title = paste("Turbine Count by", title)) +
          theme_minimal() +
          theme(axis.text.x = element_text(angle = 90, hjust = 1)))
}

```

```{r}
ggplot(data, aes(x = t_img_date)) +
  geom_line(stat = "count", aes(group = 1)) +
  labs(x = "Date", y = "Count", title = "Number of Images Over Time After 2015")

ggplot(monthly_data, aes(x = month, y = count)) +
  geom_line() +
  labs(x = "Month", y = "Count", title = "Monthly Number of Images Over Time After 2015") +
  theme_minimal()


```

```{r}
register_stadiamaps("f94c64ea-35d9-425f-af7a-e139e3bd6242", write = TRUE)

continental_map <- get_stadiamap(bbox = continental_bbox, zoom = 5, maptype = "stamen_toner_lite")

ggmap(continental_map) +
  geom_point(data = data, aes(x = xlong, y = ylat, color = t_state), size = 1) +
  labs(x = "Longitude", y = "Latitude", title = "Geographic Distribution of Turbines in Continental US") +
  theme_minimal()

alaska_map <- get_stadiamap(bbox = alaska_bbox, zoom = 4, maptype = "stamen_toner_lite")

ggmap(alaska_map) +
  geom_point(data = data, aes(x = xlong, y = ylat, color = t_state), size = 1) +
  labs(x = "Longitude", y = "Latitude", title = "Geographic Distribution of Turbines in Alaska") +
  theme_minimal()

hawaii_map <- get_stadiamap(bbox = hawaii_bbox, zoom = 7, maptype = "stamen_toner_lite")

ggmap(hawaii_map) +
  geom_point(data = data, aes(x = xlong, y = ylat, color = t_state), size = 1) +
  labs(x = "Longitude", y = "Latitude", title = "Geographic Distribution of Turbines in Hawaii") +
  theme_minimal()
  
```

```{r}

# Correlation plot if there are multiple numeric variables
correlation_matrix <- cor(numeric_data, use = "complete.obs")
print(ggplot(data = as.data.frame(as.table(correlation_matrix)),
       aes(x = Var1, y = Var2, fill = Freq)) +
  geom_tile() +
  scale_fill_gradient2(low = "blue", high = "red", mid = "white", midpoint = 0, limit = c(-1,1)) +
  labs(title = "Correlation Matrix of Numeric Variables",
       x = "Variable 1", 
       y = "Variable 2", 
       fill = "Correlation Coefficient") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)))


# End of EDA section with session information
sessionInfo()
```



